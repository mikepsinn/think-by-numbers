---
layout: base.njk
title: Search
description: "Search all articles on Think by Numbers. Find evidence-based analysis on government spending, healthcare, economics, and more."
permalink: /search/
---

<div class="container">
  <div class="main-content">
    <h2>Search</h2>
    <div style="background: white; border: 4px solid black; box-shadow: 8px 8px 0 black; padding: 30px; margin-top: 20px;">
      <div id="search"></div>
    </div>

    {# Popular articles shown when search is empty #}
    <div id="popular-articles" style="margin-top: 40px;">
      <h3>Popular Articles</h3>
      <div class="post-grid" style="margin-top: 20px;">
        {%- for post in collections.posts | limit(6) %}
        {%- if post.data.title and post.inputPath.endsWith('.md') %}
        {% include "post-card.njk" %}
        {%- endif %}
        {%- endfor %}
      </div>
    </div>
  </div>

  <aside class="sidebar">
    <div class="widget">
      <h4>About Search</h4>
      <p>Search across all posts and pages on Think by Numbers.</p>
    </div>

    <div class="widget">
      <h4>Follow Us</h4>
      <ul class="social-links">
        <li><a href="{{ site.social.facebook }}" target="_blank">Facebook</a></li>
        <li><a href="{{ site.social.twitter }}" target="_blank">Twitter</a></li>
        <li><a href="{{ site.social.linkedin }}" target="_blank">LinkedIn</a></li>
      </ul>
    </div>
  </aside>
</div>

<style>
  /* Custom search layout with icon on the left */
  #search-wrapper {
    display: flex;
    align-items: center;
    gap: 12px;
    background: white;
    border: 4px solid black;
    box-shadow: 8px 8px 0 black;
    padding: 20px;
  }

  #search-icon {
    font-size: 24px;
    flex-shrink: 0;
  }

  #search {
    flex: 1;
  }

  /* Remove extra padding/margin from Pagefind input */
  .pagefind-ui__search-input {
    padding-left: 10px !important;
  }

  /* Hide any default Pagefind icons */
  .pagefind-ui__form svg,
  .pagefind-ui__search-clear {
    display: none !important;
  }

  /* Hide ::before pseudo-element icons */
  .pagefind-ui__search-input::before,
  .pagefind-ui__form::before {
    display: none !important;
    content: none !important;
  }
</style>

<script>
  window.addEventListener('DOMContentLoaded', () => {
    // Get the search div and its parent container
    const searchDiv = document.querySelector('#search');
    const oldContainer = searchDiv.parentElement;
    const mainContent = oldContainer.parentElement;
    const popularArticles = document.querySelector('#popular-articles');

    // Create new wrapper with icon
    const wrapper = document.createElement('div');
    wrapper.id = 'search-wrapper';

    const icon = document.createElement('div');
    icon.id = 'search-icon';
    icon.textContent = 'ðŸ”';

    // Build new structure
    wrapper.appendChild(icon);
    wrapper.appendChild(searchDiv);

    // Replace old container with new wrapper
    mainContent.replaceChild(wrapper, oldContainer);

    // Initialize Pagefind UI
    const pagefind = new PagefindUI({
      element: "#search",
      showSubResults: true,
      showImages: true
    });

    // Toggle popular articles visibility based on search input
    function updatePopularArticlesVisibility() {
      const searchInput = document.querySelector('#search input[type="text"]');
      if (searchInput && popularArticles) {
        if (searchInput.value.trim().length > 0) {
          popularArticles.style.display = 'none';
        } else {
          popularArticles.style.display = 'block';
        }
      }
    }

    // Watch for input changes
    setTimeout(() => {
      const searchInput = document.querySelector('#search input[type="text"]');
      if (searchInput) {
        searchInput.addEventListener('input', updatePopularArticlesVisibility);
        // Also handle clear button clicks
        const clearBtn = document.querySelector('.pagefind-ui__search-clear');
        if (clearBtn) {
          clearBtn.addEventListener('click', () => {
            setTimeout(updatePopularArticlesVisibility, 50);
          });
        }
      }
    }, 100);

    // Auto-search if there's a query parameter
    const urlParams = new URLSearchParams(window.location.search);
    const query = urlParams.get('q');
    if (query) {
      // Hide popular articles immediately if there's a query
      if (popularArticles) {
        popularArticles.style.display = 'none';
      }
      // Wait for Pagefind to initialize, then trigger search
      setTimeout(() => {
        const searchInput = document.querySelector('#search input[type="text"]');
        if (searchInput) {
          searchInput.value = query;
          searchInput.dispatchEvent(new Event('input', { bubbles: true }));
        }
      }, 100);
    }
  });
</script>

